
# 1장 오브젝트와 의존관계
자바 엔터프라이즈 기술의 혼란 속에서 잃어버렸던 객체지향 기술의 진정한 가치를 회복시키고, 그로부터 객체지향 프로그래밍이 제공하는 폭넓은 혜택을 누릴 수 있도록 기본으로 돌아가자는 것이 바로 스프링의 핵심 철학이다. 스프링을 이해하려면 먼저 오브젝트에 깊은 관심을 가져야 한다. 

> DAO (Data Access Object) DB를 사용해 데이터를 조회하거나 조작하는 기능을 전담하도록 만든 오브젝트

> 자바빈 (혹은 빈) 다음 두 가지 관례를 따라 만들어진 오브젝트
> - 디폴트 성자 : 자바빈은 파라미터가 없는 디폴트 생성자를 갖고 있어야 한다. 툴이나 프레임워크에서 리플렉션을 이용해 오브젝트를 생성하기 때문이다. 
> - 프로퍼티 : 자바빈을 노출하는 이름을 가진 속성을 말한다. 프로퍼티는 setter(수정자 메소드)와 getter(접근자 메소드)를 이용해 수정 또는 조회할 수 있다. 

## 관심사의 분리 (Separation Of Concerns)
관심이 같은 것끼리는 하나의 객체 안으로 또는 친한 객체로 모이게 하고, 관심이 다른 것은 가능한 한 따로 떨어져서 서로 영향을 주지 않도록 분리하는 것.

> 템플릿 메소드 패턴  
> 슈퍼클래스에 기본적인 로직의 흐름을 만들고, 그 기능의 일부를 추상 메소드나 오버라이딩이 가능한 protected 메소드 등으로 만든 뒤 서브 클래스에서 메소드를 필요에 맞게 구현해서 사용하도록 하는 방법

> 팩토리 메소드 패턴  
> 서브 클래스에서 오브젝트 생성 방법과 클래스를 결정할 수 있도록 미리 정의해둔 메소드를 팩토리 메서드라 하고, 이 방식을 통해 오브젝트 생성 방법을 나머지 로직, 즉 슈퍼클래스의 기본 코드에서 독립시키는 방법. 템플릿 메소드 패턴과 같이 상속을 통해 기능을 확장하게 하는 패턴이다. 구조도 비슷하다. 슈퍼클래스 코드에서는 서브 클래스에서 구현할 메소드를 호출해서 필요한 타입의 오브젝트를 가져와 사용한다. 

## 1.5. 스프링의 IoC
스프링의 핵심을 담당하는 빈 펙토리 또는 애플리케이션 컨텍스트를 알아보자

스프링의 제어퀀을 가지고 직접 만들고 관계를 부여하는 오브젝트를 빈(Bean)이라 부른다. 오브젝트 단위의 애플리케이션 컴포넌트로 스프링 컨테이너가 생성과 관게 설정, 사용 등을 제어해주는 제어의 역전이 적용된 오브젝트를 가리키는 말이다. 

스프링에서는 빈의 생겅과 관계설정 같은 제어을 담당하는 IoC 오브젝트를 빈 팩토리라 부른다. 빈 팩토리를 확장한 애플리케이션 컨텍스트를 주로 사용한다. 빈 팩토리라고 말할 때는 빈을 생성하고 관계를 설정하는 IoC의 기본 기능에 초점을 맞춘 것이고, 애플리케이션 컨텍스트라고 말할 때는 애플리케이션 전반에 걸쳐 모든 구성요소의 제어 작업을 담당하는 IoC 엔진이라는 의미가 좀 더 부각된다고 보면 된다. 

애플리케이션 컨텍스트는 별도의 정보를 참고해서 빈(오브젝트)의 생성, 관계 설정 등의 제어 작업을 총괄한다. 

### 1.5.2. 애플리케이션 동작 방식
스프링에서 애플리케이션 컨텍스트를 IoC 컨테이너라 하기도 하고 간단히 스프링 컨테이너라고 부르기도 한다. 
ApplicationContext(interface) --(extends)--> BeanFactory

- 클라이언트는 구체적인 팩토리 클래스를 알 필요가 없다. 
  - 애플리케이션 컨텍스트를 사용하면 일관된 방식으로 원하는 오브젝트를 가져올 수 있다. 
- 애플리케이션 컨텍스트는 종합 IoC 서비스를 제공해준다. 
  - 관계설정과 생성 이외에도 오브젝트가 만들어지는 방식, 시점과 전략을 다르게 가져갈 수도 있고, 이에 부가적으로 자동생성, 오브젝트에 대한 후처리, 정보의 조합, 설정 방식의 다변화, 인터셉터 등 오브젝트를 효과적으로 활용할 수 있는 다양한 기능을 제공
- 애플리케이션 컨텍스트는 빈을 검색하는 다양한 방법을 제공한다. 

## 1.6. 싱글톤 레지스트리와 오브젝트 스코프
애플리케이션 컨텍스트는 오브젝트 팩토리와 비슷한 방식으로 동작하는 IoC 컨테이너다. 동시에 싱글톤을 저장하고 관리하는 싱글톤 레지스트리이기도 하다. 

스프링은 엔터프라이즈 서버 환경에서 운영되도록 설계되었다. 엔터프라이즈 분야에서는 '서비스 오브젝트'라는 개념을 사용하였다. 서블릿은 자바 엔터프라이즈 기술의 가장 기본이 되는 서비스 오브젝트라고 할 수 있다. 서블릿은 대부분 멀티스레드 환경에서 싱클톤으로 동작한다. 

싱글톤 레지스트리는 자바의 싱글톤 패턴의 구현 방식에 문제가 있어 스프링이 직접 싱글톤 형태의 오브젝트를 만들고 관리하는 기능을 제공한다. 스프링 빈을 싱글톤으로 만드는 것은 결국 오브젝트의 생성 방법을 제어하는 IoC 컨테이너로서의 역할이다. 

싱글톤은 상태 정보를 갖고 있지 않은 무상태(stateless) 방식으로 만들어져야 한다. 읽기 전용 값이라면 초기화 시점에서 인스턴스 변수에 저장하고 공유하는 것은 문제가 되지 않는다. 

스프링 빈의 스코프(scope)는 
- 싱글톤 스코프 : 컨테이너 내에 한 개의 오브젝트만 만들어져서, 강제로 제거하지 않는 한 계속 유지된다.
- 프로토타입 스코프 : 컨테이너에 빈을 요청할 때마다 매번 새로운 오브젝트를 생성한다. 
- request scope : HTTP 요청이 생길 때마다 생성
- session scope

## 1.7. 의존 관계 주입 (DI)
DI는 자신이 사용할 오브젝트에 대한 선택과 생성 제어권을 외부로 넘기고 자신은 수동적으로 주입받은 오브젝트를 사용하는 점에서 IoC의 개념에 잘 들어맞는다. 

의존관계 주입 이외에도 의존관계 검색도 있다. 의존 관계를 맺는 방법이 외부로부터의 주입이 아니라 스스로 검색을 이용하기 때문에 "의존관계 검색(dependency lookup)"이라고 불린다. 의존관계 검색은 런타임 시 의존관계를 맺을 오브젝트를 결정하는 것과 오브젝트의 생성 작업은 외부 컨터에너에게 IoC로 맡기지만, 이를 가져올 때는 메소드나 생성자를 통한 주입 대신 스스로 컨테이너에게 요청하는 방법을 사용한다. 애플리케이션 컨텍스트에서 제공하는 getBean() 메소드를 사용한다.
